generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrderType {
  BUY
  SELL
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  password     String
  balance      Decimal       @default(5000) @db.Decimal(15, 2)
  usedMargin   Decimal       @default(0) @db.Decimal(15, 2)
  openOrders   OpenOrder[]
  closedOrders ClosedOrder[]
}

model OpenOrder {
  id          String    @id @default(uuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  asset       String
  type        OrderType
  boughtPrice Decimal   @db.Decimal(15, 2)
  qty         Decimal   @db.Decimal(18, 8)
  margin      Decimal   @db.Decimal(15, 2)
  createdAt   DateTime  @default(now())
  
  @@index([userId])
  @@index([asset])
  @@index([createdAt])
  @@map("open_orders")  // Changed from "openOrders" to "open_orders"
}

model ClosedOrder {
  id          String    @id @default(uuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  asset       String
  type        OrderType
  boughtPrice Decimal   @db.Decimal(15, 2)
  closedPrice Decimal   @db.Decimal(15, 2)
  qty         Decimal   @db.Decimal(18, 8)
  margin      Decimal   @db.Decimal(15, 2)
  pnl         Decimal   @db.Decimal(15, 2)
  openTime    DateTime
  closedAt    DateTime  @default(now())
  
  @@index([userId])
  @@index([asset])
  @@index([closedAt])
  @@map("closed_orders")  // Changed from "closedOrders" to "closed_orders"
}